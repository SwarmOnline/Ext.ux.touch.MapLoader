<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="lib/sencha-touch/resources/css/sencha-touch.css" type="text/css">
        <title>Ext.ux.touch.MapLoader</title>
		
		<style>
			.header, .footer {
				background-image: -webkit-gradient(linear, 0% 0, 0% 100%, from(#EEF5F8), to(#BFC7CB));
				border-bottom: 1px solid #5D6469;
				padding: 3px 0 0 33px;
				color: #444;
				font-size: 12px;
			}
			
			.footer {
				border-top: 1px solid #5D6469;
				padding: 0px;
			}
			
			.loading {
				background-image: url('images/iPhoneLoader.gif'), -webkit-gradient(linear, 0% 0, 0% 100%, from(#EEF5F8), to(#BFC7CB));
				background-repeat: no-repeat;
				background-position: 10px 2px, 0 0;
			}
			
		</style>
		
        <script type="text/javascript" src="lib/sencha-touch/sencha-touch-all-debug.js"></script>
        <!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>-->
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
        <script type="text/javascript" src="Ext.ux.touch.MapLoader.js"></script>
		<script type="text/javascript" src="SwarmOnline.MyMap.js"></script>
        <script type="text/javascript">

            Ext.application({
                name: 'Ext.ux.touch.MapLoader',
                launch: function(){

                    var locationsStore = Ext.create('Ext.data.Store', {
                        storeId: 'Locations',
                        model: 'Location',
                        proxy: {
                            type: 'ajax',
                            url: 'server/search.php',
                            reader: {
                                type: 'json',
                                root: 'result'
                            }
                        }
                    });

                    var panel = Ext.create('Ext.Panel', {
                        layout: 'fit',
                        items: [Ext.create('SwarmOnline.MyMap', {
                            store: locationsStore,
                            useCurrentLocation: true,
                            geo: {
                                autoUpdate: false
                            },
                            mapOptions: {
                                center: new google.maps.LatLng(55.857809, -4.242511),
                                zoom: 17
                            }
                        }),
                            {
                                docked: 'top',
                                html: '',
                                height: 22,
                                cls: 'header'
                            }, {
                                docked: 'bottom',
                                style: 'text-align: center;',
                                html: 'www.SwarmOnline.com',
                                height: 22,
                                cls: 'footer'
                            }]
                    });

                    Ext.Viewport.add(panel);

                    panel.getItems().get(0).getStore().on({
                        beforeload: function(){
                            this.getDockedItems()[0].element.addCls('loading');
                            this.getDockedItems()[0].setHtml('loading...');
                        },
                        load: function(){
                            // Make loading icon hang around for a little longer
                            setTimeout(Ext.bind(function(){
                                this.getDockedItems()[0].element.removeCls('loading');
                                this.getDockedItems()[0].setHtml('');
                            }, this), 200);
                        },
                        scope: panel
                    });

                    panel.show();

                }
            });
        </script>
    </head>
    <body>
    </body>
</html>
